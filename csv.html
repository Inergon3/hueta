<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
<script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=l-CVB-F1GKt7T8VeQhuABBaMNo7uViBJmZ-P5vLH7WMul7e4LjhBfoc9MHKkpo2GcPzUTfCEAelCD7dQRp5aM6hpx3y343LNvZabDBDVVSX4X24pRYqFQ3osNa0kwYO8z_SIR-RLaZXcNU_kX8NdoQaDQwLEc0PEqbgqZZvksC1dR6daaDBt5PYO87eReVzwtsrGQmEah02bSVklsduvD2-cqPYb2n63bTC54AT48MyYr4MctyIks8yu9xgMTAz1fEbvlbjIL1-g2XIQlOdoiQ" charset="UTF-8"></script></head>
<body>
    <table id="res"></table>
</body>
</html>
<script>

function jsonToCsv(jsonData) {
    if (!Array.isArray(jsonData) || jsonData.length === 0) {
        throw new Error("Input data must be a non-empty array of objects.");
    }

    // Получаем заголовки (ключи первого объекта)
    const headers = Object.keys(jsonData[0]);

    // Создаем строку заголовков
    let csv = headers.join(",") + "\n";

    // Добавляем строки данных
    jsonData.forEach((item) => {
        const row = headers.map((header) => {
            // Экранируем значения, если они содержат запятые или кавычки
            let value = item[header];
            if (typeof value === "string" && (value.includes(",") || value.includes('"'))) {
                value = `"${value.replace(/"/g, '""')}"`; // Экранируем кавычки
            }
            return value;
        });
        csv += row.join(",") + "\n";
    });

    return csv;
}
    const url = window.location
    const _url = new URL(url)
    
    const hash = _url.hash.replace('#', '')
    const decodedHash = decodeURIComponent(hash)

    const json = JSON.parse(decodedHash)

    const table = document.getElementById("res")

    //[{"name":"1","games":["3","4"]},{"name":"2","games":["5","6"]}]
    const header = Object.keys(json[0])
    const tableHeader = document.createElement('tr')
    const headerRows = header.map(key => document.createElement('th'))
    headerRows.forEach((row, index) => {
        row.textContent = header[index]
    })
    table.appendChild(tableHeader)
    headerRows.forEach((row, index) => {
        tableHeader.appendChild(row)
    })

    Object.values(json).forEach(player => {
        const row = document.createElement('tr')
        Object.values(player).map(item => {
            const td = document.createElement('td')
            td.innerText = item
            row.appendChild(td)
        })
        table.appendChild(row)
    })


    
    // json.forEach(player => {
    //     Object.entries(player).map(([key, value]) => )
    // })
    // table.appendChild(`<tr>${...headerRows}</tr>`)
    // return null
    // const zalupka = _url.pathname.slice(5, _url.pathname.length)

    // const items = decodeURIComponent(zalupka)
    
    // const element = document.getElementById('csv')
    // element.textContent = jsonToCsv(JSON.parse(items))

    // console.log(zalupka, items)
</script>
